# JVM基础学习
## 一、JVM的内存结构
### 1.1 JVM内存区域
* 线程独占的：程序计数器、本地方法栈、Java虚拟机栈
* 线程共享的：堆、元空间（java8之前叫方法区）



### 1.2 各个内存区域的作用
#### 1.2.1 程序计数器
程序计数器：可以看做当前线程所执行的字节码的行号指示器，因为在虚拟机模型里，字节码解释器工作时就是通过改变这个计数器的值来选取下一个需要执行的字节码指令。
#### 1.2.2 Java虚拟机栈
Java虚拟机栈的生命周期是与线程相同的，虚拟机栈描述的是Java方法执行的内存模型：每个方法被执行时都会创建一个栈帧用于存储**局部（本地）变量表、操作数栈、动态链接、方法出口（返回地址）等信息**。每一个方法被调用到执行完成的过程，就会对应一个栈帧在虚拟机栈中入栈和出栈的过程。
#### 1.2.3 本地方法栈
本地方法栈与Java虚拟机栈非常类似，本地方法栈是针对native方法。
#### 1.2.4 Java堆
Java堆：被所有线程共享，在虚拟机启动时就创建，此区域唯一目的就是存放对象实例，**几乎所有**对象实例以及数组都在这里分配内存；
#### 1.2.5 元空间（方法区）
元空间（方法区）：被所有线程所共享，它用于存储已被加载的类信息、常量、静态变量、即时编译器编译后的代码等数据



## 二、JVM垃圾回收
### 2.1 垃圾回收算法
#### 2.1.1 引用计数算法
给对象中添加一个计数器，每当有一个地方引用它时，计数器的值都就加1；当引用失效时，计计数器的值都就减1；任何时刻计数器都为0的对象就是不能再被使用的。**无法解决循环引用问题**
``` java
/**
 * 首先要知道什么是变量：变量的实质是一小块内存单元。这一小块内存里存储着变量的值。
 * 比如 int a = 1;
 * a就是变量的名称，1就是变量的值。
 *
 * 当变量指向一个对象时，这个变量就被称为引用变量
 * 比如 A a = new A(); a就是引用变量，它指向了一个A对象，也可以说它引用了一个A对象。我们通过操纵这个a来操作A对象。 此时，变量a的值为它所引用对象的地址
 *
 * 局部变量：在使用前，必须进行显示赋值，否则编译不通过
 */
public class ReferenceCountingGC {

    public Object instance;

    public static void testGC() {
        ReferenceCountingGC objA = new ReferenceCountingGC(); // step1
        ReferenceCountingGC objB = new ReferenceCountingGC(); // step2

        objA.instance = objB; // step3
        objB.instance = objA; // step4

        objA = null; // step5
        objB = null; // step6

        /**
         * 根据引用计数算法来分析，objA、objB是不会被垃圾回收的，但是实际上是进行了垃圾回收。
         */
        System.ge();
    }
}
```
分析：
* objA对象引用new ReferenceCountingGC();objA引用计数器加1，此时objA的计数器值为1；
* objB对象引用new ReferenceCountingGC();objB引用计数器加1，此时objB的计数器值为1；
* objA.instance指向objB，所以objB的计数器加1，此时objB的计数器值为2；
* objB.instance指向objA，所以objA的计数器加1，此时objA的计数器值为2；
* objA不再指向ReferenceCountingGC()；objA引用计数器减1，此时objA的计数器值为1；
* objB不再指向ReferenceCountingGC()；objB引用计数器减1，此时objB的计数器值为1；



#### 2.1.2 可达性分析法
可达性分析算法：通过一系列名为“GC Roots”的对象作为起始点，从这些节点开始向下搜索，搜索所走的路径称为引用链，当一个对象到GC Roots没有任何引用链相连时，则证明此对象是不可用的。
可作为GC Roots的对象包括：
* 虚拟机栈（栈帧中的本地变量）中的引用的对象。
* 方法区中的类静态属性引用的对象。
* 方法区中的常量引用的对象。
* 本地方法栈中JNI（即一般说的Native方法）的引用的对象。

### 2.2 垃圾回收器




## 三、引用
